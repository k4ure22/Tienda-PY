{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Productos</title>
  <link rel="stylesheet" href="{% static 'core/general.css' %}">
  <link rel="stylesheet" href="{% static 'core/productos.css' %}">
</head>
<body>
<header class="topbar">
  <div class="topbar-left">
    <h2 class="topbar-logo">Computadores</h2>

    <form action="{% url 'productos' %}" method="get" class="topbar-search">
      <input type="text" name="q" placeholder="Buscar productos..." value="{{ query|default_if_none:'' }}">
      <button type="submit">üîç</button>
    </form>
  </div>

  <div class="topbar-center">
    <span class="topbar-title">Productos</span>
  </div>

  <div class="topbar-right">
    <a href="{% url 'solicitudes' %}" class="icon-btn" title="Notificaciones">üîî</a>

    {% if request.user.is_authenticated %}
      <a href="{% url 'perfil_usuario' request.user.id %}" class="user-chip">
        {% if request.user.foto_perfil %}
          <img src="{{ request.user.foto_perfil.url }}" alt="Foto de perfil" class="avatar">
        {% else %}
          <img src="{% static 'core/img/default-user.png' %}" alt="Foto de perfil" class="avatar">
        {% endif %}
        <span class="user-name">{{ request.user.nombre|default:request.user.email }}</span>
      </a>
      <a href="{% url 'logout' %}" class="pill pill-red">Cerrar sesi√≥n</a>
    {% else %}
      <a href="{% url 'login' %}" class="pill">Iniciar sesi√≥n</a>
    {% endif %}
  </div>
</header>


  <main class="content">
    <h1>Productos</h1>
    <div class="crear-nuevo">
  <a href="{% url 'crear' %}" class="btn-crear">Crear nuevo</a>
</div>



    <section>
  {% regroup productos by marca as productos_por_marca %}

  {% for grupo in productos_por_marca %}
    <h2 class="titulo-marca">{{ grupo.grouper }}</h2>
    <div class="grid-cards">
      {% for producto in grupo.list %}
        <a href="{% url 'detalle_producto' producto.id %}" class="card">
          {% if producto.imagen %}
            <img src="{{ producto.imagen.url }}" alt="{{ producto.marca }} {{ producto.modelo }}">
          {% else %}
            <img src="{% static 'core/img/default.png' %}" alt="Sin imagen">
          {% endif %}

          <h2 class="marca-modelo">{{ producto.marca }} {{ producto.modelo }}</h2>
          <p class="precio">${{ producto.precio|floatformat:2 }}</p>
          <p><strong>Almacenamiento:</strong> {{ producto.almacenamiento }} &nbsp;|&nbsp; <strong>RAM:</strong> {{ producto.ram }}</p>
          <p><strong>Procesador:</strong> {{ producto.procesador }}</p>
          <p class="serial"><small><strong>Serial:</strong> {{ producto.serial }}</small></p>
        </a>
      {% endfor %}
    </div>
  {% endfor %}
</section>

  </main>
</body>
</html>
